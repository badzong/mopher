<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
 "http://www.w3.org/TR/MathML2/dtd/xhtml-math11-f.dtd"
 [<!ENTITY mathml "http://www.w3.org/1998/Math/MathML">]>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="generator" content="groff -Txhtml, see www.gnu.org"/>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"/>
<meta name="Content-Style" content="text/css"/>
<style type="text/css">
       .center { text-align: center }
       .right  { text-align: right }
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<!-- Creator     : groff version 1.21 -->
<!-- CreationDate: Tue Oct 14 21:26:34 2014 -->
<title></title>
</head>
<body>

<hr/>


<p>MOPHERD.CONF(5) BSD File Formats Manual
MOPHERD.CONF(5)</p>

<p style="margin-top: 1em"><b>NAME</b></p>

<p style="margin-left:6%;"><b>mopherd.conf</b> &mdash; the
mopher daemon configuration file</p>

<p style="margin-top: 1em"><b>DESCRIPTION</b></p>

<p style="margin-left:6%;">The <b>mopherd.conf</b> file
contains the default configuration used by mopherd(8) and
mopherctl(8) to set various parameters for mopher&rsquo;s
core functionality and its modules. The list of all rules
enforced by mopher can be found in mopherd.acl(5).</p>

<p style="margin-left:6%; margin-top: 1em">Comment lines in
<b>mopherd.conf</b> start with the &lsquo;#&rsquo;
character, empty lines are treated as comments.
Configuration directives are key-value pairs and can span
multiple lines. Both key and value allow for some structure
in that a key may contain indices and a value can be a table
containing other (comma-separated) key-value pairs:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<colgroup><col width="14%"></col>
<col width="10%"></col>
<col width="11%"></col>
<col width="10%"></col>
<col width="55%"></col>
</colgroup>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_a</p></td>
<td>
</td>
<td>


<p>= &quot;string&quot;</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_b</p></td>
<td>
</td>
<td>


<p>= -1.0</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_c[id_x]</p></td>
<td></td>
<td>


<p>= 1000</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_c[id_y]</p></td>
<td></td>
<td>


<p>= 127.0.0.1</p></td>
<td>
</td></tr>
</table>

<p style="margin-left:14%; margin-top: 1em">key_d = {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<colgroup><col width="24%"></col>
<col width="11%"></col>
<col width="10%"></col>
<col width="55%"></col>
</colgroup>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_e</p></td>
<td>


<p>= &quot;/path/to/file&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_f</p></td>
<td>


<p>= 200K,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_g</p></td>
<td>


<p>= 12h,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>key_h</p></td>
<td>


<p>= ::1</p></td>
<td>
</td></tr>
</table>

<p style="margin-left:14%;">}</p>

<p style="margin-left:6%; margin-top: 1em">Each integer may
have one of the following optional suffixes:</p>

<p>s[econd]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
1</p>

<p>m[inute]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
60</p>

<p>h[our]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
3600</p>

<p>d[ay]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
86400</p>

<p>K[ibi]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
1024</p>

<p>M[ebi]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
1048576</p>

<p>G[ibi]</p>

<p style="margin-left:27%; margin-top: 1em">multiply by
1073741824</p>

<p style="margin-top: 1em"><b>GENERAL CONFIGURATION</b></p>

<p style="margin-left:6%;">The following directives control
the general behaviour of mopher (default values are enclosed
in parentheses):</p>

<p style="margin-top: 1em"><b>acl_log_level</b> (3)</p>

<p style="margin-left:14%;">Syslog severity level (0-7) for
messages logged by the <i>log</i> keyword in
mopherd.acl(5).</p>

<p style="margin-top: 1em"><b>acl_path</b>
(&quot;@sysconfdir@/mopher/mopherd.acl&quot;)</p>

<p style="margin-left:14%;">Path to mopherd.acl(5).</p>

<p style="margin-top: 1em"><b>control_socket</b>
(&quot;inet:44554@127.0.0.1&quot;)</p>

<p style="margin-left:14%;">Socket used by mopherctl(8) to
control a running mopherd(8) instance. Supported socket
types are tcp (inet:port@address) and unix domain sockets
(unix:/path/to/socket).</p>


<p style="margin-top: 1em"><b>control_socket_permissions</b>
(0660)</p>

<p style="margin-left:14%;">File system permissions of
<i>control_socket</i>. Only applies to unix domain
sockets.</p>

<p style="margin-top: 1em"><b>foreground</b> (0)</p>

<p style="margin-left:14%;">Run in foreground, don&rsquo;t
detach from the controlling terminal.</p>

<p style="margin-top: 1em"><b>greylist_deadline</b>
(1d)</p>

<p style="margin-left:14%;">Default maximal lifetime of a
greylist item. Older items will be removed from the
greylist. All <i>greylist</i> rules in mopherd.acl(5)
without a <i>deadline</i> parameter will use this value.</p>

<p style="margin-top: 1em"><b>greylist_visa</b> (30d)</p>

<p style="margin-left:14%;">Default maximal lifetime of a
greylist visa item. Older visa items will be removed from
the greylist. Greylist items are upgraded to visa items when
<i>delay</i> expires or the number of <i>attempts</i> is
met. Subsequent successful mail deliveries will renew any
existing visa item (i.e. reset its remaining lifetime).</p>

<p style="margin-top: 1em"><b>hostname</b>
(gethostname(3))</p>

<p style="margin-left:14%;">Default hostname used in
self-references.</p>

<p style="margin-top: 1em"><b>log_level</b> (4)</p>

<p style="margin-left:14%;">Syslog severity level (0-7) for
messages logged by mopherd(8).</p>

<p style="margin-top: 1em"><b>milter_socket</b>
(inet:44555@127.0.0.1)</p>

<p style="margin-left:14%;">Socket used by MTAs to
communicate with a running mopherd(8) instance. Supported
socket types are tcp (inet:port@address) and unix domain
sockets (unix:/path/to/socket).</p>


<p style="margin-top: 1em"><b>milter_socket_permissions</b>
(0660)</p>

<p style="margin-left:14%;">File system permissions of
<i>milter_socket</i>. Only applies to unix domain
sockets.</p>

<p style="margin-top: 1em"><b>milter_socket_timeout</b>
(7210s)</p>

<p style="margin-left:14%;">Default timeout for any
communication between mopher and MTAs.</p>

<p style="margin-top: 1em"><b>module_path</b>
(&quot;@libdir@/mopher&quot;)</p>

<p style="margin-left:14%;">Path to loadable mopher
modules. mopherd(8) will load all available modules in
<i>module_path</i> during startup.</p>

<p style="margin-top: 1em"><b>mopherd_user</b>
(&quot;mopher&quot;)</p>

<p style="margin-left:14%;">User ID of mopherd(8) set
during startup. All files and sockets will be created as
<i>mopher_user</i>.</p>

<p style="margin-top: 1em"><b>mopherd_group</b>
(&quot;mopher&quot;)</p>

<p style="margin-left:14%;">Group ID of mopherd(8) set
during startup. All files and sockets will be created as
<i>mopher_group</i>.</p>

<p style="margin-top: 1em"><b>tarpit_progress_interval</b>
(10s)</p>

<p style="margin-left:14%;">Interval between two progress
notifications issued during tarpitting. When mopherd(8) is
tarpitting a host, it needs to issue periodic notifications
to the MTA in order to reset its timeouts.</p>

<p style="margin-top: 1em"><b>workdir_path</b>
(&quot;/&quot;)</p>

<p style="margin-left:14%;">Working directory of mopherd(8)
set during startup.</p>

<p style="margin-top: 1em"><b>TABLE CONFIGURATION</b></p>

<p style="margin-left:6%;">Mopher keeps its lists and state
in generic tables. The following two tables are part of
mopher&rsquo;s core functionality:</p>

<p style="margin-top: 1em"><b>state</b></p>

<p style="margin-left:14%;">Contains some mopherd(8) state
data. Currently, it consists of a strictly increasing
integer, incremented by mopherd(8) on each new connection
and used as a distinct connection identifier in logs.</p>

<p style="margin-top: 1em"><b>greylist</b></p>

<p style="margin-left:14%;">Contains greylist and visa
triplets (origin, sender and recipient combinations) and
various metadata about them.</p>

<p style="margin-left:6%; margin-top: 1em">Defining a
generic table also requires specifying its backend driver.
Backend drivers will translate all requests to generic
tables into requests as they are understood by that
particular backend or library.</p>

<p style="margin-left:6%; margin-top: 1em">The two most
common types of backend drivers require one of the following
two configuration directives when configuring the
<i>greylist</i> table:</p>

<p style="margin-left:14%; margin-top: 1em"># illustrative
example raw_db, <br/>
# implementing a whole RDBMS <br/>
table[greylist] = {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<colgroup><col width="24%"></col>
<col width="11%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="45%"></col>
</colgroup>
<tr valign="top" align="left">
<td></td>
<td>


<p>driver</p></td>
<td>
</td>
<td>


<p>= &quot;raw_db&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>path</p></td>
<td>
</td>
<td>


<p>= &quot;/path/to/greylist.db&quot;</p></td>
<td>
</td></tr>
</table>

<p style="margin-left:14%;">}</p>

<p style="margin-left:14%; margin-top: 1em"># illustrative
example net_db, <br/>
# implementing socket access methods to a RDBMS <br/>
table[greylist] = {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<colgroup><col width="24%"></col>
<col width="11%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="45%"></col>
</colgroup>
<tr valign="top" align="left">
<td></td>
<td>


<p>driver</p></td>
<td>
</td>
<td>


<p>= &quot;net_db&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>host</p></td>
<td>
</td>
<td>


<p>= 127.0.0.1,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>database</p></td>
<td></td>
<td>


<p>= &quot;mopher&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>table</p></td>
<td>
</td>
<td>


<p>= &quot;greylist&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>user</p></td>
<td>
</td>
<td>


<p>= &quot;mopher&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>pass</p></td>
<td>
</td>
<td>


<p>= &quot;secret&quot;</p></td>
<td>
</td></tr>
</table>

<p style="margin-left:14%;">}</p>

<p style="margin-left:6%; margin-top: 1em">Currently
available backend drivers are:</p>

<p style="margin-top: 1em"><b>memdb</b> (Memory DB)</p>

<p style="margin-left:14%;">A simple hash table stored in
main memory. Not persistent. If no backend driver was
configured for a table, that table will use the <i>memdb</i>
driver and therefore lose all its content as soon as
mopherd(8) shuts down.</p>

<p style="margin-top: 1em"><b>bdb</b> (Berkeley DB)</p>

<p style="margin-left:14%;">Embedded database for key/value
data. Uses the legacy format/API (1.85) that is in most
distributions either part of the standard C library or
offered separately by one of the more recent db
software-packages.</p>

<p style="margin-top: 1em"><b>sakila</b> (MySQL)</p>

<p style="margin-left:14%;">SQL database management
system.</p>

<p style="margin-left:6%; margin-top: 1em"><i>Note</i>: All
backend drivers available in the mopher source distribution
are usually compiled as loadable mopher modules.</p>

<p style="margin-top: 1em"><b>MODULE CONFIGURATION</b></p>

<p style="margin-left:6%;">Loadable mopher modules may
extend mopher in mainly two ways: A Module may provide
additional backend drivers for tables or additional symbols
and functions that are made available to mopherd(8) during
its evaluation of mopherd.acl(5).</p>

<p style="margin-left:6%; margin-top: 1em">The following
list only describes configuration directives for modules
that require some configuration. See mopherd.acl(5) for
additional information on usage and behaviour.</p>

<p style="margin-left:6%; margin-top: 1em"><b>Relay and
Penpal Counter</b> <i><br/>
counter</i> counts the amount of successfully delivered
messages by a relay (address or domain) or penpal (origin,
sender and recipient combination). Both counters are stored
in tables and therefore require the selection of a backend
driver:</p>


<p style="margin-left:14%; margin-top: 1em">table[counter_relay]
= {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<colgroup><col width="24%"></col>
<col width="11%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="45%"></col>
</colgroup>
<tr valign="top" align="left">
<td></td>
<td>


<p>driver</p></td>
<td>
</td>
<td>


<p>= &quot;bdb&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>path</p></td>
<td>
</td>
<td>


<p>= &quot;/path/to/relay.db&quot;</p></td>
<td>
</td></tr>
</table>

<p style="margin-left:14%;">}</p>


<p style="margin-left:14%; margin-top: 1em">table[counter_penpal]
= {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<colgroup><col width="24%"></col>
<col width="11%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="45%"></col>
</colgroup>
<tr valign="top" align="left">
<td></td>
<td>


<p>driver</p></td>
<td>
</td>
<td>


<p>= &quot;bdb&quot;,</p></td>
<td>
</td></tr>
<tr valign="top" align="left">
<td></td>
<td>


<p>path</p></td>
<td>
</td>
<td>


<p>= &quot;/path/to/penpal.db&quot;</p></td>
<td>
</td></tr>
</table>

<p style="margin-left:14%;">}</p>

<p style="margin-left:6%; margin-top: 1em">The following
directives control the general behaviour of <i>counter</i>
(default values are enclosed in parentheses):</p>

<p style="margin-top: 1em"><b>counter_expire_low</b>
(7d)</p>

<p style="margin-left:14%;">Default maximal lifetime of a
counter item with a value less than
<i>counter_threshold</i>.</p>

<p style="margin-top: 1em"><b>counter_expire_high</b>
(60d)</p>

<p style="margin-left:14%;">Default maximal lifetime of a
counter item with a value greater than
<i>counter_threshold</i>.</p>

<p style="margin-top: 1em"><b>counter_threshold</b> (3)</p>

<p style="margin-left:14%;">See <i>counter_expire_low</i>
and <i>counter_expire_high</i>.</p>

<p style="margin-left:6%; margin-top: 1em"><b>DNSBL
Resolver</b> <i><br/>
rbl</i> maps DNSBL query results to mopherd.acl(5) symbols.
Each black- or whitelist needs to be defined through the
indexed keyword <i>rbl</i> before it can be used in
mopherd.acl(5):</p>

<p style="margin-left:14%; margin-top: 1em">rbl[list_foo] =
blacklist.foo.org <br/>
rbl[list_bar] = whitelist.bar.net</p>

<p style="margin-left:6%; margin-top: 1em">where the name
of the index is the name of the symbol exported to
mopherd.acl(5).</p>

<p style="margin-left:6%; margin-top: 1em"><b>SpamAssassin
Resolver</b> <i><br/>
spamd</i> submits messages to SpamAssassin and maps the
evaluation results to mopherd.acl(5) symbols.</p>

<p style="margin-left:6%; margin-top: 1em">The following
directives control the general behaviour of <i>spamd</i>
(default values are enclosed in parentheses):</p>

<p style="margin-top: 1em"><b>spamd_socket</b>
(&quot;inet:783@127.0.0.1&quot;)</p>

<p style="margin-left:14%;">Socket used by mopherd(8) to
check incoming messages for their score and matching
tests.</p>

<p style="margin-top: 1em"><b>IMPLEMENTATION NOTES</b></p>

<p style="margin-left:6%;">Third party distributors of
binary packages may split a full mopher build into several
complementary packages in order to make some dependencies
optional. In such cases, it is possible that some modules
are not available on your system even though they are
documented here.</p>

<p style="margin-top: 1em"><b>SEE ALSO</b></p>

<p style="margin-left:6%;">mopher(7), mopherd(8),
mopherctl(8)</p>

<p style="margin-left:6%; margin-top: 1em">BSD
July&nbsp;13, 2014 BSD</p>
<hr/>
</body>
</html>
