# Install paths
prefix=@prefix@
exec_prefix=@exec_prefix@
sbindir=@sbindir@
libdir=@libdir@
sysconfdir=@sysconfdir@
mandir=@datarootdir@/man
man1dir=$(mandir)/man1
man5dir=$(mandir)/man5

# Program paths

CC=@CC@
LEX=@LEX@
YACC=@YACC@
OBJCOPY=@OBJCOPY@
AR=@AR@
TAR=@TAR@
GZIP=@GZIP@
INSTALL=@INSTALL@
SED=@SED@


# Flags

YFLAGS=-d
CFLAGS=-Wall -g @CFLAGS@
SOFLAGS=-shared -nostartfiles -fPIC
LDFLAGS=-rdynamic @LDFLAGS@ @LIBS@ @MOD_LIBS@
ARFLAGS=rcs


# CONF_DIR is used in man pages

CONF_DIR=@sysconfdir@/mopher


# Paths (defs.c)

MOPHERD_DIR=@libdir@/lib/mopher
MOPHERD_CONF=@sysconfdir@/mopher/mopherd.conf
MAIL_ACL=@sysconfdir@/mopher/mail.acl


# Files

ACFILES=config.h Makefile Makefile.common src/Makefile src/modules/Makefile man/Makefile


# Targets

.SUFFIXES: .c .o .so .man .gz

.c.so:
	$(CC) $(CFLAGS) $(SOFLAGS) -o $@ $<

.c.o:
	$(CC) $(CFLAGS) -c $<

.man.gz:
	@echo prepare man page: $@
	@$(SED) -e "s|\$$MOPHERD_DIR|$(MOPHERD_DIR)|g" $< \
	| $(SED) -e "s|\$$MOPHERD_CONF|$(MOPHERD_CONF)|g" \
	| $(SED) -e "s|\$$MAIL_ACL|$(MAIL_ACL)|g" \
	| $(SED) -e "s|\$$CONF_DIR|$(CONF_DIR)|g" \
	| $(GZIP) -c > $@
