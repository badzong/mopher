# Makefile

include Makefile.common

SUBDIR=			src/modules src
DO_SUBDIR=		for i in $(SUBDIR); do \
				$(MAKE) -C $$i $$target; done

all: subdir

subdir:
	$(DO_SUBDIR)

install: install_program install_modules install_config

install_program:
	$(INSTALL_DIR) $(DESTDIR)$(PROGRAM_PATH)
	for P in $(PROG); do \
		$(INSTALL_PROG) src/$$P $(DESTDIR)$(PROGRAM_PATH); \
	done

install_modules:
	$(INSTALL_DIR) $(DESTDIR)$(MODULE_PATH)
	$(INSTALL_PROG) src/modules/*.so $(DESTDIR)$(MODULE_PATH)

install_config:
	$(INSTALL_DIR) $(DESTDIR)$(CONFIG_INSTPATH)
	for C in $(CONF); do \
		$(INSTALL_DATA) config/$$C \
			$(DESTDIR)$(CONFIG_INSTPATH); \
	done

uninstall:
	-for P in $(PROG); do \
		rm -i $(DESTDIR)$(PROGRAM_PATH)/$$P; \
	done
	-rm -ri $(DESTDIR)$(MODULE_PATH)
	-rm -ri $(DESTDIR)$(CONFIG_INSTPATH)

clean:
	target=$@; $(DO_SUBDIR)
