# Makefile

include Makefile.common

SUBDIR=			src/modules src man
MAKE_SUBDIR=		for i in $(SUBDIR); do \
				(cd $$i && $(MAKE) $$target); done

all: subdir

subdir:
	$(MAKE_SUBDIR)

install: install_program install_modules install_config install_man

install_program:
	$(INSTALL_DIR) $(DESTDIR)$(PROGRAM_PATH)
	for P in $(PROG); do \
		$(INSTALL_PROG) src/$$P $(DESTDIR)$(PROGRAM_PATH); \
	done

install_modules:
	$(INSTALL_DIR) $(DESTDIR)$(MODULE_PATH)
	$(INSTALL_PROG) src/modules/*.so $(DESTDIR)$(MODULE_PATH)

install_config:
	$(INSTALL_DIR) $(DESTDIR)$(CONFIG_INST)
	for C in $(CONF); do \
                DESTFILE=$(DESTDIR)$(CONFIG_INST)/$$C; \
		test -f $$DESTFILE || $(INSTALL_DATA) config/$$C $$DESTFILE; \
	done

install_man:
	for M in $(MAN); do \
		sect=man$${M##*.}; \
		$(INSTALL_DIR) $(DESTDIR)$(MAN_PATH)/$$sect; \
		$(INSTALL_DATA) man/$$M $(DESTDIR)$(MAN_PATH)/$$sect; \
	done

uninstall:
	-for P in $(PROG); do \
		rm -i $(DESTDIR)$(PROGRAM_PATH)/$$P; \
	done
	-rm -ri $(DESTDIR)$(MODULE_PATH)
	-rm -ri $(DESTDIR)$(CONFIG_INST)
	-for M in $(MAN); do \
		sect=man$${M##*.}; \
		rm -i $(DESTDIR)$(MAN_PATH)/$$sect/$$M; \
	done

clean:
	target=$@; $(MAKE_SUBDIR)
