include @top_srcdir@/Makefile.common

INCLUDE=-I@top_srcdir@ -I@top_srcdir@/src/include
CFLAGS+=$(INCLUDE)

build=@top_srcdir@/build
modules=@top_srcdir@/build/modules

OBJECTS=\
	$(modules)/cast.o\
	$(modules)/string.o\
	$(modules)/list.o\
	$(modules)/spamd.o\
	$(modules)/rbl.o\
	$(modules)/counter.o\
	$(modules)/regex.o\
	$(modules)/memdb.o\
	$(modules)/@MOD_ACL_SPF@\
	$(modules)/@MOD_DB_BDB@\
	$(modules)/@MOD_DB_MYSQL@\

MODULES=\
	$(modules)/cast.so\
	$(modules)/string.so\
	$(modules)/list.so\
	$(modules)/spamd.so\
	$(modules)/rbl.so\
	$(modules)/counter.so\
	$(modules)/regex.so\
	$(modules)/memdb.so\
	$(modules)/@MOD_ACL_SPF@\
	$(modules)/@MOD_DB_BDB@\
	$(modules)/@MOD_DB_MYSQL@\

MOD_ALL=@MOD_ALL@

all: $(modules) $(MOD_ALL)

$(modules):
	mkdir -p $(modules)

$(modules)/bdb.so: bdb.c
	$(CC) $(CFLAGS) $(SOFLAGS) $(LDFLAGS) -ldb -o $@ $<

$(modules)/sakila.so: sakila.c
	$(CC) $(CFLAGS) $(SOFLAGS) $(LDFLAGS) -lmysqlclient -o $@ $<

$(modules)/spf.so: spf.c
	$(CC) $(CFLAGS) $(SOFLAGS) $(LDFLAGS) -lspf2 -o $@ $<

$(modules)/lib.a: $(OBJECTS)
	$(AR) $(ARFLAGS) $@ $^

$(modules)/%.so: %.c
	$(CC) $(CFLAGS) $(SOFLAGS) -o $@ $<
